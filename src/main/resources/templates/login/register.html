<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleag.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link data-n-head="ssr" rel="icon" type="image/x-icon" href="https://cdn.comento.kr/favicon/favicon.ico">
    <link rel="stylesheet" href="/css/login-page/register.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" />
    <link rel="stylesheet" href="/css/modal/modal.css">
    <link rel="stylesheet" href="/css/main-page/header.css">
    <title>회원가입</title>
</head>
<body>
<header th:replace="~{/main-page/header :: #post-header}"></header>
    <div id="join">
        <div class="modal">
            <div class="warn-modal">
                <div id="content-wrap"></div>
            </div>
        </div>
        <div class="c-application c-grid main-grid-component fluid" style="min-height: 100vh; background-color: rgb(255, 255, 255);">
            <div class="c-application c-row">
                <div class="register-wrapper">
                    <div id="register" class="mb-85">
                        <div class="c-application c-box register-view-wrapper" style="background-color: rgb(255, 255, 255); padding: 60px 38.5px;">
                            <div class="c-application c-typography mb-40 c-headline3 f-semi-bold" style="color: rgb(32, 35, 37); line-height: 140%; font-size: 24px;">
					            회원가입
                            </div>
                            <div class="register-buttons-container">
                                <div class="register-button c-pointer full email" id="btn-modal">
                                    <div class="register-button-icon">
                                        <img src="https://cdn.comento.kr/icon/icon-email-medium.svg">
                                    </div>
                                    <div class="ml-6">
                                        <div class="c-application c-typography c-body1 f-regular"> 이메일로 회원가입하기 </div>
                                    </div>
                                </div>
                                <div class="register-button c-pointer full kakao">
                                    <div class="register-button-icon">
                                        <img src="https://cdn.comento.kr/icon/icon-kakao-medium.svg" alt>
                                    </div>
                                    <div class="ml-6">
                                        <div class="c-application c-typography c-body1 f-regular" style="color: inherit;"> 카카오로 1초만에 시작하기 </div>
                                    </div>
                                </div>
                                <div class="register-button c-pointer full naver" @click="naverLogin">
                                    <div class="register-button-icon">
                                        <img src="https://cdn.comento.kr/icon/icon-naver-medium.svg" alt>
                                    </div>
                                    <div class="ml-6">
                                        <div class="c-application c-typography c-body1 f-regular" style="color: inherit;"> 네이버로 시작하기 </div>
                                    </div>
                                </div>
                                <div></div>
                            </div>
                            <div>
                                <p class="c-application c-typography agreement-wrapper mb-8 c-caption1" style="color: rgb(173, 179, 184); text-align: center;">
                                        <u class="c-application c-typography c-caption1" style="color: rgb(118, 125, 130);"> 이용약관 </u>
                                    및
                                        <u class="c-application c-typography c-caption1"> 개인정보 처리방침 </u>
                                    확인 후 동의합니다
                                </p>
                                <a th:href="@{/login/login-start}" target="_self">
                                    <u class="c-application c-typography d-block c-caption1" style="color: rgb(42, 125, 225); text-align: center; margin-left: 87px;">
                                        이미 가입하셨나요?
                                    </u>
                                </a>
                            </div>
                        </div>

                    <form th:action="@{/login/register}" name="join" method="post" th:object="${userVO}">
                        <div class="modal-mask" style="display: none;">
                            <div class="modal-container">
                                <img src="https://comento.kr/images/gray_remove.svg" class="box-remove icon-sm-md pointer" alt>
                                <div id="alert-component" class="modal-body text-center">
                                    <h4 class="popup-title mb-20 text-center" style="margin-left: 25px;"></h4>
                                    <div class="text-heading mb-20 text-center">
                                        <p class="modal-message"></p>
                                    </div>
                                    <div class="mb-20"></div>
                                    <button class="btn text-center pl-30 pr-30" style="height: 40px; line-height: 40px; padding: 0px 50px !important;">확인</button>
                                </div>
                            </div>
                        </div>

                        <div class="modal-mask modal-overlay" id="modal" style="display: none;">
                            <div class="modal-container" style="border-radius: 20px;">
                                <img src="https://comento.kr/images/gray_remove.svg" class="box-remove icon-sm-md pointer close-area" alt>
                                <div id="signInAgree" class="modal-body text-center">
                                        <h2 class="text-normal">회원 가입</h2>
                                        <section class="apply-card-new text-left" style="margin-top: 30px;">
                                            <div id="mb-50">
                                                <div class="inputbox-group">
                                                    <span>
                                                        <label>
                                                            <b>이메일</b>
                                                        </label>
                                                        <p class="h7 mb-5">*연락받을 이메일을 정확히 입력하세요.</p>
                                                        <input th:field="*{userEmail}" placeholder="your@email.com"
                                                               class="inputbox" type="email" style="width: 100%;">
                                                        <span class="error-text" id="emailError"></span>
                                                    </span>
                                                </div>
                                                <div class="inputbox-group">
                                                    <span>
                                                        <label>
                                                            <b>이름</b>
                                                        </label>
                                                        <p class="h7 mb-5">*이름을 입력하세요.</p>
                                                        <input th:field="*{userName}" placeholder="이름을 적어주세요" class="inputbox"
                                                               type="text" style="width: 100%;">
                                                        <span class="error-text"></span>
                                                    </span>
                                                </div>
                                                <div class="inputbox-group">
                                                    <span>
                                                        <label>
                                                            <b>비밀번호</b>
                                                        </label>
                                                        <p class="h7 mb-5">*비밀번호를 정확히 입력하세요.</p>
                                                        <input th:field="*{userPassword}" placeholder="비밀번호를 적어주세요" class="inputbox"
                                                               type="password" style="width: 100%;">
                                                        <span class="error-text"></span>
                                                    </span>
                                                </div>

                                                <button id="nextButton" type="button" class="btn1 apply-btn btn btn-lg btn-full disabled"> 다음 </button>
                                            </div>


                                            <div id="remainingContent" class="term" style="display: none; margin-top: 70px;">
                                                <div id="check-all-wrap">
                                                    <label class="checkbox-all-wrap">
                                                        <section>
                                                            <input type="checkbox" name="checkAll">
                                                            <span class="checkbox" style="margin-right: 10px;">
                                                                <img src="/image/icon/check_all.png" width="15px">
                                                            </span>
                                                            <p class="h5">전체 동의</p>
                                                        </section>
                                                    </label>
                                                </div>
                                                <ul>
                                                    <h6>서비스 이용을 위해 동의가 필요합니다.</h6>
                                                    <li>
                                                        <div id="check">
                                                            <label class="checkbox-wrap">
                                                                <section style="display: flex;">
                                                                    <input type="checkbox" name="check" class="required check">
                                                                    <span class="checkbox" style="margin-right: 10px;">
                                                                        <img src="/image/icon/check.png" width="15px">
                                                                    </span>
                                                                    <p class="h6">[필수] 이용약관 동의</p>
                                                                </section>
                                                            </label>
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div>
                                                            <label class="checkbox-wrap">
                                                                <section style="display: flex;">
                                                                    <input type="checkbox" name="check" class="required">
                                                                    <span class="checkbox" style="margin-right: 10px;">
                                                                        <img src="/image/icon/check.png" width="15px">
                                                                    </span>
                                                                    <p class="h6">[선택] 코멘토의 혜택 등 유용한 정보 안내를<br> 문자와 메일로 수신합니다</p>
                                                                </section>
                                                            </label>
                                                        </div>
                                                    </li>
                                                </ul>
                                                <button id="check-button" type="submit" class="apply-btn btn btn-lg btn-full disabled" style="margin-top: 100px;"> 완료 </button>
                                            </div>
                                        </section>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="/js/login/register-modal.js"></script>
<script src="/js/login/check.js"></script>
<script src="/js/login/disabled.js"></script>

<script>
    function showRemainingContent() {
  // 이메일, 닉네임, 패스워드가 있는 화면을 숨김 처리
  document.getElementById("mb-50").style.display = "none";
  // 숨겨져 있던 나머지 화면들을 보이게 처리
  document.getElementById("remainingContent").style.display = "block";
}
document.getElementById("nextButton").addEventListener("click", showRemainingContent);
</script>
<script>
    // 유효성 검사를 수행하는 함수
    function validateInput(input) {
        var fieldName = input.getAttribute("name");
        var errorTextElement = input.parentElement.querySelector(".error-text");
        var isValid = true;

        // 필드별 유효성 검사
        if (fieldName === "userEmail") {
            // 이메일 유효성 검사
            if (!validateEmail(input.value)) {
                errorTextElement.textContent = "이메일을 입력하세요.";
                isValid = false;
            } else {
                var emailInput = input.value.trim();
                if (emailInput !== "") {
                    checkEmailDuplication(emailInput);
                } else {
                    errorTextElement.textContent = "";
                    document.getElementById("userName").disabled = false;
                    document.getElementById("userPassword").disabled = false;
                }
            }
        } else if (fieldName === "userName") {
            // 닉네임 유효성 검사
            if (input.value.trim() === "") {
                errorTextElement.textContent = "이름을 입력하세요.";
                isValid = false;
            } else {
                errorTextElement.textContent = "";
            }
        } else if (fieldName === "userPassword") {
            // 비밀번호 유효성 검사
            if (input.value.length < 8) {
                errorTextElement.textContent = "비밀번호는 8자 이상이어야 합니다.";
                isValid = false;
            } else {
                errorTextElement.textContent = "";
            }
        }

        return isValid;
    }

    // 이메일 유효성 검사 함수
    function validateEmail(email) {
        // 이메일 유효성 검사를 수행하는 코드
        var emailRegex = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
        return emailRegex.test(email);
    }

    // 입력 필드의 blur 이벤트 핸들러 함수
    function handleBlurEvent(event) {
        var input = event.target;
        validateInput(input);
    }

    // 모든 입력 필드에 blur 이벤트 핸들러 등록
    var inputFields = document.querySelectorAll('.inputbox');
    inputFields.forEach(function (input) {
        input.addEventListener("blur", handleBlurEvent);
    });

    // 다음 버튼 클릭 이벤트 핸들러 함수
    document.getElementById("nextButton").addEventListener("click", function () {
        var isValid = true;
        inputFields.forEach(function (input) {
            if (!validateInput(input)) {
                isValid = false;
            }
        });
    });

    function checkEmailDuplication(email) {
        $.ajax({
            url: "/login/check-email/" + email,
            success: function (result) {
                var errorTextElement = document.getElementById("emailError");
                if (result) {
                    errorTextElement.textContent = "중복된 이메일입니다.";
                    errorTextElement.style.color = "#e92525";
                    document.getElementById("userName").disabled = true;
                    document.getElementById("userPassword").disabled = true;
                } else {
                    errorTextElement.textContent = "사용 가능한 이메일입니다.";
                    errorTextElement.style.color = "#2a7de1";
                    document.getElementById("userName").disabled = false;
                    document.getElementById("userPassword").disabled = false;
                }
            },

        });
    }
</script>
    </html>